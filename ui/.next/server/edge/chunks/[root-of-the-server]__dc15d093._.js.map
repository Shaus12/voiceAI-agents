{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import type { NextRequest } from 'next/server';\r\nimport { NextResponse } from 'next/server';\r\n\r\nconst OSS_TOKEN_COOKIE = 'voicefx_oss_token';\r\nconst OSS_USER_COOKIE = 'voicefx_oss_user';\r\n\r\nfunction generateOSSToken(): string {\r\n  return `oss_${Date.now()}_${crypto.randomUUID()}`;\r\n}\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const authProvider = process.env.NEXT_PUBLIC_AUTH_PROVIDER || 'stack';\r\n\r\n  // Only handle OSS mode\r\n  if (authProvider !== 'local') {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  const response = NextResponse.next();\r\n  const token = request.cookies.get(OSS_TOKEN_COOKIE)?.value;\r\n\r\n  // If no token exists, create one\r\n  if (!token) {\r\n    const newToken = generateOSSToken();\r\n    const user = {\r\n      id: newToken,\r\n      name: 'Local User',\r\n      provider: 'local',\r\n      organizationId: `org_${newToken}`,\r\n    };\r\n\r\n    // Set cookies in the response (httpOnly for security)\r\n    response.cookies.set(OSS_TOKEN_COOKIE, newToken, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 60 * 60 * 24 * 30, // 30 days\r\n      path: '/',\r\n    });\r\n\r\n    response.cookies.set(OSS_USER_COOKIE, JSON.stringify(user), {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 60 * 60 * 24 * 30, // 30 days\r\n      path: '/',\r\n    });\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\n// Configure which routes the middleware runs on\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except:\r\n     * - api routes\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - public files (public folder)\r\n     */\r\n    '/((?!api|_next/static|_next/image|favicon.ico|public).*)',\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;AACA;AAAA;;AAEA,MAAM,mBAAmB;AACzB,MAAM,kBAAkB;AAExB,SAAS;IACP,OAAO,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,OAAO,UAAU,IAAI;AACnD;AAEO,SAAS,WAAW,OAAoB;IAC7C,MAAM,eAAe,QAAQ,GAAG,CAAC,yBAAyB,IAAI;IAE9D,uBAAuB;IACvB,IAAI,iBAAiB,SAAS;QAC5B,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,IAAI;IAClC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAErD,iCAAiC;IACjC,IAAI,CAAC,OAAO;QACV,MAAM,WAAW;QACjB,MAAM,OAAO;YACX,IAAI;YACJ,MAAM;YACN,UAAU;YACV,gBAAgB,CAAC,IAAI,EAAE,UAAU;QACnC;QAEA,sDAAsD;QACtD,SAAS,OAAO,CAAC,GAAG,CAAC,kBAAkB,UAAU;YAC/C,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK,KAAK;YACvB,MAAM;QACR;QAEA,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB,KAAK,SAAS,CAAC,OAAO;YAC1D,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK,KAAK;YACvB,MAAM;QACR;IACF;IAEA,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;;KAOC,GACD;KACD;AACH"}}]
}